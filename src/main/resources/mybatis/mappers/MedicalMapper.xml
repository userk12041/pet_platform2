<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.boot.dao.MedicalReservationDAO">

    <!-- ✅ 진료 예약 등록 -->
    <insert id="insertMedicalReservation" parameterType="com.boot.dto.MedicalReservationDTO">
        INSERT INTO MEDICAL_RESERVATION (
            ID,
            PET_ID,
            USER_ID,
            USER_NAME,
            PHONE_NUMBER,
            NAME,
            TYPE,
            GENDER,
            AGE,
            NOTE,
            RESERVATION_DATE,
            RESERVATION_TIME,
            CREATED_AT
        ) VALUES (
            MEDICAL_RESERVATION_SEQ.NEXTVAL,
            #{petId},
            #{userId},
            #{userName},
            #{phoneNumber},
            #{name},
            #{type},
            #{gender},
            #{age},
            #{note, jdbcType=CLOB},
            #{reservationDate, jdbcType=DATE},
            #{reservationTime},
            #{createdAt, jdbcType=DATE}
        )
    </insert>

	<select id="getMedicalList" resultType="com.boot.dto.MedicalDTO">
		select id, pet_name, treatment_date, doctor_id, content, prescription, notes, user_id, created_at, updated_at
		from medical
	</select>
	
	<select id="getMedicalInfo" parameterType="long" resultType="com.boot.dto.MedicalDTO">
        select id, pet_name, treatment_date, doctor_id, content, prescription, notes, user_id, created_at, updated_at
		from medical
		where id = #{id}
    </select>
    
    <insert id="insertMedical" parameterType="com.boot.dto.MedicalDTO">
    	insert into medical(id, pet_name, treatment_date, doctor_id, content,
    						prescription, notes, user_id)
    			values (medical_seq.NEXTVAL, #{pet_name}, #{treatment_date}, #{doctor_id},
    			 		#{content}, #{prescription}, #{notes}, #{user_id})
    </insert>

    <update id="updateMedicalInfo" parameterType="com.boot.dto.MedicalDTO">
    	update medical 
    	set pet_name = #{pet_name}, doctor_id = #{doctor_id}, content = #{content}, 
    	    prescription = #{prescription}, notes = #{notes}, updated_at = CURRENT_TIMESTAMP
    	where id = #{id}
    </update>
    
	<delete id="deleteMedical" parameterType="long">
		delete from medical where id = #{id}
	</delete>
	
</mapper>